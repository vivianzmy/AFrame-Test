<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>A-Frame Test</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Animation mixer for skinned GLB animations (Mixamo, etc.) -->
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script>
      // ============================================
      // FACE CAMERA COMPONENT
      // ============================================
      AFRAME.registerComponent('face-camera', {
        tick: function() {
          const camera = document.querySelector('#camera');
          if (camera) {
            const cameraPos = camera.getAttribute('position');
            const elPos = this.el.getAttribute('position');
            
            const dx = cameraPos.x - elPos.x;
            const dy = cameraPos.y - elPos.y;
            const dz = cameraPos.z - elPos.z;
            
            const yAngle = Math.atan2(dx, dz) * (180 / Math.PI);
            const distance = Math.sqrt(dx * dx + dz * dz);
            const xAngle = -Math.atan2(dy, distance) * (180 / Math.PI);
            
            this.el.setAttribute('rotation', `${xAngle} ${yAngle} 0`);
          }
        }
      });

      // ============================================
      // PNG TRANSPARENCY FIX COMPONENT
      // ============================================
      AFRAME.registerComponent('fix-png-transparency', {
        init: function() {
          this.applyFix = this.applyFix.bind(this);
          
          // Try to apply fix immediately
          this.applyFix();
          
          // Also try after model loads
          this.el.addEventListener('loaded', this.applyFix);
          this.el.addEventListener('model-loaded', this.applyFix);
          
          // Use tick to check when texture becomes available
          this.textureFixed = false;
        },
        
        tick: function() {
          if (!this.textureFixed) {
            this.applyFix();
          }
        },
        
        applyFix: function() {
          // Handle a-image elements (plane geometry)
          let mesh = this.el.getObject3D('mesh');
          if (!mesh) {
            // For a-image, try to get the plane mesh
            const object3D = this.el.object3D;
            if (object3D && object3D.children && object3D.children.length > 0) {
              mesh = object3D.children.find(child => child.type === 'Mesh');
            }
          }
          
          if (!mesh) return;
          
          const material = mesh.material;
          if (!material) return;
          
          const texture = material.map;
          if (!texture) return;
          
          // Fix texture settings to prevent white halo at distance
          // Disable mipmaps to prevent alpha bleeding from mipmap filtering at distance
          texture.generateMipmaps = false;
          // Use LinearFilter for both - without mipmaps, this prevents distance artifacts
          texture.minFilter = THREE.LinearFilter;
          texture.magFilter = THREE.LinearFilter;
          // PNGs are typically NOT premultiplied, so set to false
          // Premultiplied alpha can cause white halos if the PNG isn't actually premultiplied
          texture.premultiplyAlpha = false;
          texture.needsUpdate = true;
          
          // Fix material settings
          material.transparent = true;
          // Match premultipliedAlpha with texture setting
          material.premultipliedAlpha = false;
          // Increase alphaTest to cut off more edge pixels and prevent white fringe
          material.alphaTest = 0.5;
          // Use proper blending to avoid halo artifacts
          material.blending = THREE.NormalBlending;
          material.side = THREE.DoubleSide;
          material.needsUpdate = true;
          
          this.textureFixed = true;
        },
        
        remove: function() {
          this.el.removeEventListener('loaded', this.applyFix);
          this.el.removeEventListener('model-loaded', this.applyFix);
        }
      });

      // ============================================
      // FORCE MODEL COLOR COMPONENT
      // ============================================
      AFRAME.registerComponent('force-model-color', {
        schema: {
          color: { type: 'color', default: '#ffffff' }
        },
        init: function() {
          this.applyColor = this.applyColor.bind(this);
          this.el.addEventListener('model-loaded', this.applyColor);
        },
        applyColor: function() {
          const mesh = this.el.getObject3D('mesh');
          if (!mesh) return;
          mesh.traverse((node) => {
            if (node.isMesh && node.material) {
              if (Array.isArray(node.material)) {
                node.material.forEach((mat) => {
                  mat.color = new THREE.Color(this.data.color);
                  mat.needsUpdate = true;
                });
              } else {
                node.material.color = new THREE.Color(this.data.color);
                node.material.needsUpdate = true;
              }
            }
          });
        },
        remove: function() {
          this.el.removeEventListener('model-loaded', this.applyColor);
        }
      });

      // ============================================
      // MONEY MANAGEMENT SYSTEM
      // ============================================
      let money = 1000;
      const ITEM_COST = 100;
      let currentUserId = '';
      let currentQ1 = '';
      let currentQ2 = '';
      let currentQ3 = '';

      // ============================================
      // CART SYSTEM
      // ============================================
      let cartItems = [];
      let purchasedItems = new Set();

      // Add item to cart
      function addToCart(itemName) {
        cartItems.push(itemName);
        updateCartUI();
      }

      // Update cart UI display
      function updateCartUI() {
        const cartList = document.getElementById('cart-list');
        const cartTotalEl = document.getElementById('cart-total');
        
        if (!cartList) return;
        
        // Clear existing items
        cartList.innerHTML = '';
        
        // Add each cart item with price
        cartItems.forEach(item => {
          const itemDiv = document.createElement('div');
          itemDiv.innerHTML = `
            <span>${item.toUpperCase()}</span>
            <span>$100</span>
          `;
          cartList.appendChild(itemDiv);
        });
        
        // Update total
        if (cartTotalEl) {
          const total = cartItems.length * 100;
          cartTotalEl.innerHTML = `
            <span>TOTAL</span>
            <span>$${total}</span>
          `;
        }
      }

      // Update money display
      function updateMoneyDisplay() {
        const moneyText = document.querySelector('#money-text');
        if (moneyText) {
          moneyText.setAttribute('value', `$${money}`);
        }
        // Also update HTML HUD
        const hud = document.querySelector('#hud');
        if (hud) {
          hud.textContent = `$${money}`;
        }
      }

      // Flash money display red when deducted
      function flashMoneyRed() {
        const hud = document.querySelector('#hud');
        if (hud) {
          // Store original color
          const originalColor = hud.style.color || '#565656';
          // Change to red
          hud.style.color = '#ff0000';
          // Restore original color after 1 second
          setTimeout(() => {
            hud.style.color = originalColor;
          }, 1000);
        }
      }

      // Deduct cost from money (prevents going negative)
      function deductCost(cost) {
        if (money >= cost) {
          money -= cost;
          updateMoneyDisplay();
          flashMoneyRed(); // Flash red when money is deducted
          return true;
        }
        return false;
      }

      // ============================================
      // TOAST NOTIFICATION SYSTEM
      // ============================================
      function showToast(itemName) {
        const toastHud = document.getElementById('toast-hud');
        if (!toastHud) return;

        toastHud.textContent = `+ ${itemName.toUpperCase()}`;
        toastHud.classList.add('show');

        setTimeout(() => {
          toastHud.classList.remove('show');
        }, 1000);
      }

      // Show insufficient balance popup
      function showInsufficientBalance() {
        const popup = document.getElementById('insufficient-popup');
        if (!popup) return;

        popup.textContent = "INSUFFICIENT BALANCE";
        popup.classList.add('show');

        setTimeout(() => {
          popup.classList.remove('show');
        }, 1000);
      }

      // Show summary screen with typewriter effect
      function showSummaryScreen() {
        const summaryScreen = document.getElementById('summary-screen');
        const summaryContent = document.getElementById('summary-content');
        const summaryDate = document.getElementById('summary-date');
        const summaryUserIdDisplay = document.getElementById('summary-user-id');
        const summaryBreakdownText = document.getElementById('summary-breakdown-text');
        const summaryValuesText = document.getElementById('summary-values-text');
        const valuesBarFill = document.getElementById('values-bar-fill');
        const summaryBodyOverlay = document.getElementById('summary-body-overlay');
        if (!summaryScreen || !summaryContent) return;

        // Build summary text from cartItems (each item = $100)
        let lines = [];
        lines.push('PURCHASE SUMMARY');
        lines.push('');

        const itemWidth = 28;
        const amountLabel = 'AMOUNT';
        lines.push(`${'ITEM'.padEnd(itemWidth, ' ')}${amountLabel}`);
        lines.push(''.padEnd(itemWidth + amountLabel.length, '.'));

        if (cartItems.length === 0) {
          lines.push('NO ITEMS SELECTED.');
        } else {
          cartItems.forEach(item => {
            const itemText = item.toUpperCase();
            lines.push(`${itemText.padEnd(itemWidth, '.')} $100`);
          });
        }

        lines.push('');
        const total = cartItems.length * 100;
        lines.push(`${'TOTAL'.padEnd(itemWidth, '.')} $${total}`);

        const fullText = lines.join('\n');

        const physicalItems = new Set([
          'Height Extension',
          'Shoulder Width',
          'Breast Adjustments',
          'Waist Sculpting',
          'Ab Etching',
          'Arm Slimming',
          'Butt Implants',
          'Eye Color',
          'Eyelid Alteration',
          'Brow Lift',
          'Nose Job',
          'Lip Shape',
          'Cheekbone Alteration',
          'Smile Brightening',
          'Skin Texture Smoothing',
          'Jawline Altercation',
          'Face Lift'
        ]);

        let physicalCount = 0;
        let skillCount = 0;

        cartItems.forEach((item) => {
          if (physicalItems.has(item)) {
            physicalCount += 1;
          } else {
            skillCount += 1;
          }
        });

        const physicalSpend = physicalCount * 100;
        const skillSpend = skillCount * 100;
        const totalCount = cartItems.length;
        const physicalShare = totalCount ? Math.round((physicalCount / totalCount) * 100) : 0;
        const skillShare = totalCount ? Math.round((skillCount / totalCount) * 100) : 0;

        const ratingBase = Math.min(100, 50 + totalCount * 5);
        const perfectionRating = `${ratingBase}/100`;

        const breakdownLines = [];
        breakdownLines.push('CATEGORY BREAKDOWN');
        breakdownLines.push(''.padEnd(42, '='));
        breakdownLines.push(`PHYSICAL ALTERATIONS`.padEnd(30, '.') + ` $${physicalSpend}`);
        breakdownLines.push(`SKILL ENHANCEMENTS`.padEnd(30, '.') + ` $${skillSpend}`);
        breakdownLines.push('');
        breakdownLines.push('TRANSACTION SHARE');
        breakdownLines.push(''.padEnd(42, '-'));
        breakdownLines.push(`PHYSICAL`.padEnd(30, '.') + ` ${physicalShare}%`);
        breakdownLines.push(`SKILL`.padEnd(30, '.') + ` ${skillShare}%`);
        breakdownLines.push('');
        breakdownLines.push(`PERFECTION RATING`.padEnd(30, '.') + ` ${perfectionRating}`);

        // Prepare screen
        summaryScreen.style.display = 'block';
        summaryContent.textContent = '';
        if (summaryDate) {
          summaryDate.textContent = new Date().toLocaleDateString();
        }
        if (summaryUserIdDisplay) {
          summaryUserIdDisplay.textContent = `USER ID: ${currentUserId || 'N/A'}`;
        }
        if (summaryBreakdownText) {
          summaryBreakdownText.textContent = breakdownLines.join('\n');
        }

        const appearanceChoices = new Set(['How you present', 'Improve appearance']);
        const skillChoices = new Set(['What you know', 'Practice answers', 'Research the company', 'Competence']);
        const personalityChoices = new Set(['Confidence', 'Luck']);

        const answers = [currentQ1, currentQ2, currentQ3].filter(Boolean);
        let appearanceScore = 0;
        let skillScore = 0;
        let personalityScore = 0;

        answers.forEach((answer) => {
          if (appearanceChoices.has(answer)) appearanceScore += 1;
          if (skillChoices.has(answer)) skillScore += 1;
          if (personalityChoices.has(answer)) personalityScore += 1;
        });

        const skillsPersonalityScore = skillScore + personalityScore;
        const totalScore = appearanceScore + skillsPersonalityScore;
        const appearancePercent = totalScore ? Math.round((appearanceScore / totalScore) * 100) : 0;
        const skillsPersonalityPercent = totalScore ? 100 - appearancePercent : 0;

        const valuesLine = `User ${currentUserId || 'N/A'} values ` +
          `${skillsPersonalityPercent}% skills/personality and ${appearancePercent}% appearance in life.`;

        if (summaryValuesText) {
          summaryValuesText.textContent = valuesLine;
        }
        if (valuesBarFill) {
          valuesBarFill.style.width = `${appearancePercent}%`;
        }

        if (summaryBodyOverlay) {
          const diagramPoints = {
            'Eye Color': { x: 210, y: 5 },
            'Eyelid Alteration': { x: 210, y: -12 },
            'Brow Lift': { x: 210, y: -17 },
            'Nose Job': { x: 210, y: 15 },
            'Lip Shape': { x: 210, y: 24.5 },
            'Cheekbone Alteration': { x: 206, y: 0.5 },
            'Smile Brightening': { x: 210, y: 42.5 },
            'Jawline Altercation': { x: 208, y: 32.5 },
            'Face Lift': { x: 210, y: -25.5 },
            'Skin Texture Smoothing': { x: 210, y: 74 },
            'Shoulder Width': { x: 210, y: 56 },
            'Breast Adjustments': { x: 210, y: 56 },
            'Waist Sculpting': { x: 210, y: 88 },
            'Ab Etching': { x: 210, y: 90 },
            'Arm Slimming': { x: 82, y: 72 },
            'Butt Implants': { x: 90, y: 112 },
            'Height Extension': { x: 210, y: 136 }
          };

          const uniqueItems = Array.from(new Set(cartItems));
          summaryBodyOverlay.innerHTML = '';

          const ns = 'http://www.w3.org/2000/svg';
          const defs = document.createElementNS(ns, 'defs');
          const marker = document.createElementNS(ns, 'marker');
          marker.setAttribute('id', 'arrowhead');
          marker.setAttribute('markerWidth', '6');
          marker.setAttribute('markerHeight', '6');
          marker.setAttribute('refX', '5');
          marker.setAttribute('refY', '3');
          marker.setAttribute('orient', 'auto');
          const arrow = document.createElementNS(ns, 'path');
          arrow.setAttribute('d', 'M0,0 L6,3 L0,6 Z');
          arrow.setAttribute('fill', '#2c2c2c');
          marker.appendChild(arrow);
          defs.appendChild(marker);
          summaryBodyOverlay.appendChild(defs);

          uniqueItems.forEach((item) => {
            const point = diagramPoints[item];
            if (!point) return;
            const startX = point.x < 150 ? 20 : 280;
            const startY = point.y;
            const textX = point.x < 150 ? startX + 6 : startX - 6;
            const textAnchor = point.x < 150 ? 'start' : 'end';

            const line = document.createElementNS(ns, 'line');
            line.setAttribute('x1', startX.toString());
            line.setAttribute('y1', startY.toString());
            line.setAttribute('x2', point.x.toString());
            line.setAttribute('y2', point.y.toString());
            line.setAttribute('stroke', '#2c2c2c');
            line.setAttribute('stroke-width', '1');
            line.setAttribute('marker-end', 'url(#arrowhead)');

            const dot = document.createElementNS(ns, 'circle');
            dot.setAttribute('cx', point.x.toString());
            dot.setAttribute('cy', point.y.toString());
            dot.setAttribute('r', '2');
            dot.setAttribute('fill', '#2c2c2c');

            const label = document.createElementNS(ns, 'text');
            label.setAttribute('x', textX.toString());
            label.setAttribute('y', (startY - 2).toString());
            label.setAttribute('fill', '#2c2c2c');
            label.setAttribute('font-size', '8');
            label.setAttribute('letter-spacing', '0.08em');
            label.setAttribute('text-anchor', textAnchor);
            label.textContent = item.toUpperCase();

            summaryBodyOverlay.appendChild(line);
            summaryBodyOverlay.appendChild(dot);
            summaryBodyOverlay.appendChild(label);
          });
        }

        // Typewriter effect
        let i = 0;
        const speed = 30; // ms per character

        function typeNext() {
          if (i <= fullText.length) {
            summaryContent.textContent = fullText.slice(0, i);
            i++;
            setTimeout(typeNext, speed);
          }
        }

        typeNext();
      }

      // Export summary screen as PDF
      async function exportSummaryAsPDF() {
        const summaryScreen = document.getElementById('summary-screen');
        const exportButton = document.getElementById('export-button');
        if (!summaryScreen) return;

        const originalHeight = summaryScreen.style.height;
        const originalOverflow = summaryScreen.style.overflow;
        const originalScrollTop = summaryScreen.scrollTop;
        const originalExportDisplay = exportButton ? exportButton.style.display : '';

        summaryScreen.style.height = `${summaryScreen.scrollHeight}px`;
        summaryScreen.style.overflow = 'visible';
        summaryScreen.scrollTop = 0;
        if (exportButton) {
          exportButton.style.display = 'none';
        }

        // Use html2canvas to capture the full summary page (with grid/background)
        const canvas = await html2canvas(summaryScreen, {
          scale: 2,
          useCORS: true,
          backgroundColor: '#dbe6dc'
        });

        summaryScreen.style.height = originalHeight;
        summaryScreen.style.overflow = originalOverflow;
        summaryScreen.scrollTop = originalScrollTop;
        if (exportButton) {
          exportButton.style.display = originalExportDisplay;
        }
        const imgData = canvas.toDataURL('image/png');

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');

        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const imgWidth = pageWidth;
        const imgHeight = canvas.height * imgWidth / canvas.width;

        let y = 0;
        if (imgHeight > pageHeight) {
          // If taller than a single page, scale to fit height instead
          const ratio = pageHeight / imgHeight;
          const scaledWidth = imgWidth * ratio;
          const scaledHeight = imgHeight * ratio;
          const x = (pageWidth - scaledWidth) / 2;
          pdf.addImage(imgData, 'PNG', x, 0, scaledWidth, scaledHeight);
        } else {
          const x = 0;
          y = (pageHeight - imgHeight) / 2;
          pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
        }

        pdf.save('purchase-summary.pdf');
      }

      // ============================================
      // MENU CHOICE COMPONENT
      // ============================================
      const facialFeatureConfigs = {
        'Eye Color': {
          multiple: [
            { src: '/eyeball.glb', position: '-0.07 0.23 0.26', scale: '0.02 0.02 0.02' },
            { src: '/eyeball.glb', position: '0.07 0.23 0.26', scale: '0.02 0.02 0.02' }
          ]
        },
        'Brow Lift': { src: '/eyebrows.glb', position: '0 0.27 0.24', scale: '0.2 0.2 0.2' },
        'Nose Job': { src: '/nose__blender_sculpt.glb', position: '0 0.12 0.28', scale: '0.03 0.03 0.03' },
        'Lip Shape': { src: '/speed_sculpt_lips.glb', position: '0 0.06 0.28', scale: '0.044 0.044 0.044' },
        'Smile Brightening': { src: '/teeth.glb', position: '0 0.07 0.29', scale: '0.05 0.05 0.05' }
      };

      function showFacialFeature(itemName) {
        const config = facialFeatureConfigs[itemName];
        if (!config) return;
        const mannequin = document.getElementById('mannequin');
        if (!mannequin) return;

        const multiple = config.multiple || [config];
        multiple.forEach((featureConfig, index) => {
          const featureId = `${itemName}-${index}`;
          let feature = mannequin.querySelector(`[data-feature="${featureId}"]`);
          if (!feature) {
            feature = document.createElement('a-entity');
            feature.setAttribute('gltf-model', `url(${featureConfig.src})`);
            feature.setAttribute('position', featureConfig.position);
            feature.setAttribute('scale', featureConfig.scale);
            feature.setAttribute('rotation', featureConfig.rotation || '0 0 0');
            feature.setAttribute('data-feature', featureId);
            mannequin.appendChild(feature);
          }
          feature.setAttribute('visible', true);
        });
      }

      // This component handles clicks on menu items
      // It reads the itemName from the clicked entity's data attribute
      // The click detection uses mouse-based raycaster, so it targets the actual entity under the mouse cursor
      AFRAME.registerComponent('menu-choice', {
        schema: {
          itemName: { type: 'string', default: 'Item' },
          cost: { type: 'number', default: 100 }
        },
        
        init: function() {
          // Set starting opacity to 0 so colliders are invisible by default
          this.el.setAttribute('material', 'opacity', 0);
          
          // DEBUG: Log collider position for alignment
          console.log('menu-choice collider', this.data.itemName, this.el.getAttribute('position'));
          
          // Click handler: reads itemName from the actual clicked entity
          // HOW CLICK TARGET TEXT IS RETRIEVED:
          // 1. The mouse-based raycaster (rayOrigin: mouse) ensures clicks happen where the mouse cursor is
          // 2. When a menu item is clicked, the event fires on that specific entity (this.el)
          // 3. We read the itemName from this.el.components['menu-choice'].data.itemName
          // 4. This guarantees we get the exact text from the entity that was actually intersected by the mouse raycast
          this.handleClick = (evt) => {
            // DEBUG: Log click event
            console.log('CLICK', this.data.itemName, this.el.getAttribute('position'));
            
            // Get the clicked entity - this.el is the entity that was actually intersected by the mouse raycaster
            // The mouse raycaster (rayOrigin: mouse) ensures this is the entity under the mouse cursor, not the center reticle
            const clickedEntity = this.el;
            
            // Read itemName from the clicked entity's menu-choice component data
            // This ensures we get the exact text from the entity that was clicked
            const menuChoiceComponent = clickedEntity.components['menu-choice'];
            if (!menuChoiceComponent) {
              console.error('Menu choice component not found on clicked entity');
              return;
            }
            
            // Get the exact item name from the clicked entity's component data
            const itemName = menuChoiceComponent.data.itemName;
            const cost = menuChoiceComponent.data.cost;
            
            // Deduct cost
            if (purchasedItems.has(itemName)) {
              console.log(`Already purchased: ${itemName}`);
              return;
            }

            if (deductCost(cost)) {
              purchasedItems.add(itemName);
              // Show toast notification with the exact item name from the clicked entity
              // The toast text is updated based on the clicked item's itemName property
              showToast(itemName);
              showFacialFeature(itemName);
              // Add to cart
              addToCart(itemName);
              console.log(`Purchased: ${itemName} for $${cost}. Remaining: $${money}`);
            } else {
              console.log(`Insufficient funds! Need $${cost}, have $${money}`);
              showInsufficientBalance();
            }
          };
          
          // Attach click listener to this specific menu item entity
          // The mouse raycaster will only trigger this if the mouse cursor is over this entity
          this.el.addEventListener('click', this.handleClick);
          
          // Hover feedback disabled - hitboxes remain invisible at all times
          // this.el.addEventListener('mouseenter', () => {
          //   this.el.setAttribute('material', 'opacity', 0.12);
          // });
          // this.el.addEventListener('mouseleave', () => {
          //   this.el.setAttribute('material', 'opacity', 0);
          // });
        },
        
        remove: function() {
          this.el.removeEventListener('click', this.handleClick);
        }
      });

      // Initialize money display and raycaster intersection logging when scene loads
      document.addEventListener('DOMContentLoaded', () => {
        const scene = document.querySelector('a-scene');
        scene.addEventListener('loaded', () => {
          updateMoneyDisplay();
          
          // DEBUG: Listen to raycaster-intersection events to verify mouse-based raycasting
          const mouseCursorEl = document.querySelector('#mouseCursor');
          if (mouseCursorEl) {
            mouseCursorEl.addEventListener('raycaster-intersection', (e) => {
              const intersections = e.detail.intersections || [];
              const itemNames = intersections
                .map(i => {
                  if (i.object && i.object.el) {
                    const menuChoice = i.object.el.components['menu-choice'];
                    if (menuChoice) {
                      const pos = i.object.el.getAttribute('position');
                      console.log('Hit collider:', menuChoice.data.itemName, 'at position:', pos);
                      return menuChoice.data.itemName;
                    }
                  }
                  return null;
                })
                .filter(name => name !== null);
              console.log('Intersections from mouse:', itemNames);
            });
            
            mouseCursorEl.addEventListener('raycaster-intersection-cleared', () => {
              console.log('Mouse raycaster cleared (no intersections)');
            });
          } else {
            console.error('mouseCursor element not found!');
          }

          // Cart button toggle logic
          const cartButton = document.getElementById('cart-button');
          const cartPanel = document.getElementById('cart-panel');

          if (cartButton && cartPanel) {
            cartButton.addEventListener('click', () => {
              cartPanel.classList.toggle('open');
            });
          }

          // DONE button handler
          const doneButton = document.getElementById('done-button');
          const summaryScreen = document.getElementById('summary-screen');

          if (doneButton && summaryScreen) {
            doneButton.addEventListener('click', () => {
              // Hide A-Frame scene and HUD UI
              if (scene) scene.style.display = 'none';
              const hud = document.getElementById('hud');
              if (hud) hud.style.display = 'none';
              if (cartButton) cartButton.style.display = 'none';
              if (cartPanel) cartPanel.style.display = 'none';
              const insufficientPopup = document.getElementById('insufficient-popup');
              if (insufficientPopup) insufficientPopup.style.display = 'none';

              // Show summary with typewriter effect
              showSummaryScreen();
            });
          }

          // EXPORT button handler
          const exportButton = document.getElementById('export-button');
          if (exportButton) {
            exportButton.addEventListener('click', () => {
              exportSummaryAsPDF();
            });
          }
        });
      });

      document.addEventListener('DOMContentLoaded', () => {
        const startScreen = document.getElementById('start-screen');
        const infoScreen = document.getElementById('info-screen');
        const noteScreen = document.getElementById('note-screen');
        const enterButton = document.getElementById('enter-button');
        const startButton = document.getElementById('start-button');
        const infoForm = document.getElementById('info-form');

        const scene = document.querySelector('a-scene');
        const userSummaryTop = document.getElementById('user-summary-top');
        const toastHud = document.getElementById('toast-hud');
        const hud = document.getElementById('hud');
        const cartButton = document.getElementById('cart-button');
        const cartPanel = document.getElementById('cart-panel');
        const doneButton = document.getElementById('done-button');
        const insufficientPopup = document.getElementById('insufficient-popup');

        const appElements = [scene, userSummaryTop, toastHud, hud, cartButton, cartPanel, doneButton, insufficientPopup];

        const hideApp = () => {
          appElements.forEach((el) => {
            if (el) el.style.display = 'none';
          });
        };

        const showApp = () => {
          appElements.forEach((el) => {
            if (el) el.style.display = '';
          });
          if (userSummaryTop) {
            userSummaryTop.style.display = 'block';
          }
          if (startScreen) startScreen.classList.add('hidden');
          if (infoScreen) infoScreen.classList.add('hidden');
          if (uploadScreen) uploadScreen.classList.add('hidden');
          if (scene && scene.resize) {
            scene.resize();
          }
          window.dispatchEvent(new Event('resize'));
        };

        hideApp();

        showApp();

        const generateUserId = () => {
          const part1 = Math.floor(100 + Math.random() * 900);
          const part2 = Math.floor(10 + Math.random() * 90);
          const part3 = Math.floor(1000 + Math.random() * 9000);
          return `${part1}-${part2}-${part3}`;
        };

        if (enterButton && startScreen && infoScreen) {
          enterButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            infoScreen.classList.remove('hidden');
            document.body.style.background = '#ffffff';
            const userIdInput = document.getElementById('info-user-id');
            if (userIdInput && !userIdInput.value) {
              userIdInput.value = generateUserId();
            }
          });
        }

        if (infoForm && infoScreen) {
          infoForm.addEventListener('submit', (event) => {
            event.preventDefault();

            const nameInput = document.getElementById('info-name');
            const ageInput = document.getElementById('info-age');
            const userIdInput = document.getElementById('info-user-id');

            const summaryName = document.getElementById('summary-name');
            const summaryAge = document.getElementById('summary-age');
            const summaryQ1 = document.getElementById('summary-q1');
            const summaryQ2 = document.getElementById('summary-q2');
            const summaryQ3 = document.getElementById('summary-q3');

            const nameValue = nameInput ? nameInput.value.trim() : '';
            const ageValue = ageInput ? ageInput.value.trim() : '';
            const userIdValue = userIdInput ? userIdInput.value.trim() : '';
            const q1Value = infoForm.querySelector('input[name="q1"]:checked')?.value || '';
            const q2Value = infoForm.querySelector('input[name="q2"]:checked')?.value || '';
            const q3Value = infoForm.querySelector('input[name="q3"]:checked')?.value || '';

            if (summaryName) summaryName.value = nameValue;
            if (summaryAge) summaryAge.value = ageValue;
            currentUserId = userIdValue;
            currentQ1 = q1Value;
            currentQ2 = q2Value;
            currentQ3 = q3Value;
            if (summaryQ1) summaryQ1.value = q1Value;
            if (summaryQ2) summaryQ2.value = q2Value;
            if (summaryQ3) summaryQ3.value = q3Value;

            if (userSummaryTop) {
              userSummaryTop.textContent =
                `NAME: ${nameValue}  •  ` +
                `AGE: ${ageValue}  •  ` +
                `ID: ${userIdValue}`;
            }

            infoScreen.classList.add('hidden');
            if (noteScreen) {
              noteScreen.classList.remove('hidden');
            }
          });
        }

        if (startButton && noteScreen) {
          startButton.addEventListener('click', () => {
            noteScreen.classList.add('hidden');
            document.body.style.background = '';
            showApp();
          });
        }
      });
    </script>
    <style>
      html, body { margin: 0; height: 100%; }
      body {
        background: #000000;
        font-family: "MiSans Light", MiSans, sans-serif;
      }
      .screen {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        background: #000000;
        color: #ffffff;
        z-index: 30000;
      }
      .screen.hidden {
        display: none;
      }
      #enter-button {
        padding: 12px 32px;
        border: 1px solid #ffffff;
        background: transparent;
        color: #ffffff;
        font-size: 20px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        cursor: pointer;
        font-family: "MiSans Light", MiSans, sans-serif;
      }
      #enter-button:hover {
        background: #ffffff;
        color: #000000;
      }
      #info-screen {
        background: #ffffff;
        color: #000000;
      }
      #info-form {
        width: min(520px, 90vw);
        display: flex;
        flex-direction: column;
        gap: 18px;
      }
      .info-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .info-question {
        display: flex;
        flex-direction: column;
        gap: 8px;
        font-size: 12px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }
      .info-options {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 13px;
        text-transform: none;
      }
      .info-options label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        text-transform: none;
      }
      .info-options input[type="radio"] {
        accent-color: #000000;
      }
      .info-field label {
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }
      .info-field input,
      .info-field select {
        border: none;
        border-bottom: 1px solid #000000;
        padding: 6px 2px;
        font-family: "MiSans Light", MiSans, sans-serif;
        font-size: 16px;
        background: transparent;
        outline: none;
      }
      #continue-button {
        margin-top: 12px;
        align-self: center;
        padding: 10px 28px;
        border: 1px solid #000000;
        background: #000000;
        color: #ffffff;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        cursor: pointer;
        font-family: "MiSans Light", MiSans, sans-serif;
      }
      #note-screen {
        background: #ffffff;
        color: #000000;
      }
      .sticky-note {
        background: #fff6a8;
        color: #222222;
        padding: 24px 28px;
        width: min(420px, 85vw);
        min-height: 140px;
        box-shadow: 0 8px 18px rgba(0,0,0,0.2);
        border: 1px solid rgba(0,0,0,0.15);
        transform: rotate(-1.5deg);
        font-size: 14px;
        line-height: 1.6;
        letter-spacing: 0.04em;
        text-transform: none;
      }
      #start-button {
        margin-top: 24px;
        padding: 10px 28px;
        border: 1px solid #000000;
        background: #000000;
        color: #ffffff;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        cursor: pointer;
        font-family: "MiSans Light", MiSans, sans-serif;
      }
      #user-summary-top {
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        display: none;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.55);
        color: #000000;
        font-size: 12px;
        font-family: "MiSans Light", MiSans, sans-serif;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        z-index: 11000;
        pointer-events: none;
        white-space: nowrap;
      }
      #hud {
        position: fixed;
        top: 20px;
        right: 20px;
        color: #565656;
        font-size: 32px;
        font-weight: bold;
        font-family: "MiSans Bold", MiSans, sans-serif;
        pointer-events: none;
        z-index: 9999;
      }
      #toast-hud {
        position: fixed;
        left: 50%;
        bottom: 20px;
        transform: translateX(-50%);
        color: #4dcc4d;
        font-size: 20px;
        font-family: "MiSans Light", MiSans, sans-serif;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        opacity: 0;
        transition: opacity 0.2s ease-out;
        pointer-events: none;
        z-index: 12000;
      }
      #toast-hud.show {
        opacity: 1;
      }
      #cart-button {
        position: fixed;
        left: 20px;
        bottom: 20px;
        padding: 8px 14px;
        font-size: 12px;
        font-family: "MiSans Light", MiSans, sans-serif;
        background: #ffffff;
        color: #e06562;
        border: 1px solid #ccc;
        border-radius: 8px;
        cursor: pointer;
        text-transform: uppercase;
        z-index: 10000;
      }
      #cart-panel {
        position: fixed;
        left: 20px;
        bottom: 60px;
        width: 240px;
        max-height: 220px;
        background: #e06562;
        border-radius: 10px;
        box-shadow: 0 4px 16px rgba(0,0,0,0.25);
        overflow: hidden;
        font-family: "MiSans Light", MiSans, sans-serif;
        font-size: 11px;
        color: #ffffff;
        z-index: 10000;
        transform: translateY(110%);
        opacity: 0;
        pointer-events: none;
        transition: transform 0.25s ease-out, opacity 0.25s ease-out;
      }
      #cart-panel.open {
        transform: translateY(0%);
        opacity: 1;
        pointer-events: auto;
      }
      #cart-panel-header {
        font-weight: 600;
        padding: 8px 12px;
        border-bottom: 1px solid rgba(255,255,255,0.25);
        text-transform: uppercase;
      }
      #cart-list {
        overflow-y: auto;
        max-height: 150px;
      }
      #cart-list > div {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 12px;
        border-bottom: 1px solid rgba(255,255,255,0.15);
        text-transform: uppercase;
      }
      #cart-total {
        padding: 8px 12px;
        font-weight: 600;
        border-top: 1px solid rgba(255,255,255,0.25);
        display: flex;
        justify-content: space-between;
        text-transform: uppercase;
      }
      #insufficient-popup {
        position: fixed;
        left: 50%;
        bottom: 40px;
        transform: translateX(-50%);
        background: #e06562;
        color: #ffffff;
        font-family: "MiSans Light", MiSans, sans-serif;
        padding: 16px 32px;
        border-radius: 8px;
        font-size: 20px;
        font-weight: 300;
        text-transform: uppercase;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.25s ease-out;
        z-index: 20000;
      }
      #insufficient-popup.show {
        opacity: 1;
      }
      #done-button {
        position: fixed;
        right: 20px;
        bottom: 20px;
        padding: 8px 18px;
        font-size: 12px;
        font-family: "MiSans Light", MiSans, sans-serif;
        background: #3ba96b;
        color: #ffffff;
        border: none;
        border-radius: 999px;
        cursor: pointer;
        text-transform: uppercase;
        z-index: 10000;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      }
      #summary-screen {
        position: fixed;
        inset: 0;
        background: #dbe6dc;
        color: #1f1f1a;
        display: none;
        z-index: 20000;
        font-family: "Courier New", Courier, "Nimbus Mono PS", monospace;
        padding: 42px 48px;
        box-sizing: border-box;
        overflow-y: auto;
      }
      #summary-screen::before {
        content: "";
        position: absolute;
        inset: 0;
        background:
          linear-gradient(to bottom, rgba(0,0,0,0.08) 1px, transparent 1px),
          linear-gradient(to right, rgba(0,0,0,0.06) 1px, transparent 1px);
        background-size: 100% 26px, 26px 100%;
        opacity: 0.55;
        pointer-events: none;
      }
      #summary-document {
        position: relative;
        z-index: 1;
        max-width: 820px;
        margin: 0 auto;
        border: 1px solid rgba(0,0,0,0.6);
        padding: 22px 24px 26px 24px;
        box-sizing: border-box;
      }
      #summary-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 18px;
      }
      #summary-header h1 {
        font-size: 16px;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        margin: 0;
      }
      #summary-header .doc-seal {
        border: 1px solid rgba(0,0,0,0.7);
        border-radius: 2px;
        padding: 4px 8px;
        font-size: 10px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
      }
      #summary-meta {
        display: grid;
        grid-template-columns: auto 1fr auto 1fr;
        gap: 8px 12px;
        align-items: end;
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        margin-bottom: 18px;
      }
      #summary-user-id {
        font-size: 12px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        margin: 6px 0 18px 0;
      }
      #summary-meta span {
        border-bottom: 1px solid rgba(0,0,0,0.7);
        padding-bottom: 2px;
        min-width: 140px;
      }
      .summary-columns {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        align-items: start;
        margin: 0 auto 24px auto;
        max-width: 760px;
      }
      #summary-content {
        margin: 0;
        white-space: pre-wrap;
        font-size: 13px;
        line-height: 1.65;
        text-transform: uppercase;
      }
      #user-info {
        max-width: 760px;
        margin: 18px auto 0 auto;
        font-size: 12px;
        text-transform: uppercase;
      }
      #user-info h2 {
        margin: 0 0 10px 0;
        font-size: 12px;
        letter-spacing: 0.16em;
      }
      #summary-breakdown {
        margin: 0;
        font-size: 12px;
        text-transform: uppercase;
      }
      #summary-breakdown h2 {
        margin: 0 0 10px 0;
        font-size: 12px;
        letter-spacing: 0.16em;
      }
      #summary-breakdown-text {
        white-space: pre-wrap;
        font-size: 12px;
        line-height: 1.6;
      }
      #summary-values {
        margin: 18px 0 0 0;
        font-size: 12px;
        text-transform: uppercase;
      }
      #summary-values h2 {
        margin: 0 0 10px 0;
        font-size: 12px;
        letter-spacing: 0.16em;
      }
      #summary-values-text {
        white-space: pre-wrap;
        font-size: 12px;
        line-height: 1.6;
        margin-bottom: 10px;
      }
      #summary-diagram {
        margin: 18px 0 0 0;
      }
      #summary-diagram h2 {
        margin: 0 0 10px 0;
        font-size: 12px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
      }
      .diagram-frame {
        position: relative;
        width: 100%;
        max-width: 520px;
        margin: 0 auto;
        border: 1px solid rgba(0,0,0,0.6);
        background: rgba(255,255,255,0.2);
      }
      .diagram-frame img {
        display: block;
        width: 100%;
        height: auto;
      }
      .diagram-frame svg {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .values-bar {
        position: relative;
        height: 10px;
        border: 1px solid rgba(0,0,0,0.7);
        background: rgba(0,0,0,0.04);
      }
      .values-bar-fill {
        height: 100%;
        background: rgba(0,0,0,0.35);
        width: 50%;
      }
      .values-bar-labels {
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        letter-spacing: 0.12em;
        margin-top: 6px;
      }
      .user-table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid rgba(0,0,0,0.7);
      }
      .user-table th,
      .user-table td {
        border: 1px solid rgba(0,0,0,0.5);
        padding: 8px 10px;
        text-align: left;
        vertical-align: top;
      }
      .user-table th {
        width: 180px;
        font-weight: 400;
        letter-spacing: 0.08em;
        background: rgba(0,0,0,0.05);
      }
      .user-table input {
        width: 100%;
        border: none;
        background: transparent;
        font-family: "Courier New", Courier, "Nimbus Mono PS", monospace;
        font-size: 12px;
        text-transform: uppercase;
        outline: none;
      }
      #export-button {
        display: block;
        margin: 28px auto 12px auto;
        padding: 10px 26px;
        font-size: 12px;
        font-family: "MiSans Light", MiSans, sans-serif;
        text-transform: uppercase;
        background: transparent;
        color: #111111;
        border: 1px solid #111111;
        border-radius: 4px;
        cursor: pointer;
        letter-spacing: 0.12em;
      }
      #export-button:hover {
        opacity: 0.9;
      }
      .a-enter-vr, 
      .a-enter-ar, 
      .a-enter-fullscreen {
        bottom: auto !important;
        right: auto !important;
        top: 50px !important;
        left: -1360px !important;
        z-index: 99999 !important;
      }
    </style>
  </head>
  <body>
    <div id="start-screen" class="screen">
      <button id="enter-button">ENTER</button>
    </div>
    <div id="info-screen" class="screen hidden">
      <form id="info-form">
        <div class="info-field">
          <label for="info-name">Name</label>
          <input id="info-name" name="name" type="text" required />
        </div>
        <div class="info-field">
          <label for="info-age">Age</label>
          <input id="info-age" name="age" type="number" min="0" required />
        </div>
        <div class="info-field">
          <label for="info-user-id">User ID</label>
          <input id="info-user-id" name="userId" type="text" readonly />
        </div>
        <div class="info-question">
          <div>In interviews, you rely more on:</div>
          <div class="info-options">
            <label><input type="radio" name="q1" value="How you present" required /> How you present</label>
            <label><input type="radio" name="q1" value="What you know" required /> What you know</label>
          </div>
        </div>
        <div class="info-question">
          <div>If you had one hour before an interview:</div>
          <div class="info-options">
            <label><input type="radio" name="q2" value="Practice answers" required /> Practice answers</label>
            <label><input type="radio" name="q2" value="Improve appearance" required /> Improve appearance</label>
            <label><input type="radio" name="q2" value="Research the company" required /> Research the company</label>
          </div>
        </div>
        <div class="info-question">
          <div>You believe interviews reward:</div>
          <div class="info-options">
            <label><input type="radio" name="q3" value="Confidence" required /> Confidence</label>
            <label><input type="radio" name="q3" value="Competence" required /> Competence</label>
            <label><input type="radio" name="q3" value="Luck" required /> Luck</label>
          </div>
        </div>
        <button id="continue-button" type="submit">Continue</button>
      </form>
    </div>
    <div id="note-screen" class="screen hidden">
      <div class="sticky-note">
        You are entering an interview for your ideal role. Adjust your qualifications and appearance accordingly.
      </div>
      <button id="start-button" type="button">Start</button>
    </div>
    <div id="user-summary-top"></div>
    <div id="toast-hud"></div>
    <div id="hud">$1000</div>
    <div id="cart-button">My Cart</div>
    <div id="cart-panel">
      <div id="cart-panel-header">My Cart</div>
      <div id="cart-list"></div>
      <div id="cart-total"></div>
    </div>
    <div id="insufficient-popup"></div>
    <div id="done-button">DONE</div>
    <div id="summary-screen">
      <div id="summary-document">
        <div id="summary-header">
          <h1>Official Transaction Record</h1>
          <div class="doc-seal">Authorized</div>
        </div>
        <div id="summary-meta">
          <div>Document No.</div>
          <span id="summary-doc-id">AFR-2026</span>
          <div>Date</div>
          <span id="summary-date"></span>
        </div>
        <div id="summary-user-id"></div>
        <div class="summary-columns">
          <div id="summary-content"></div>
          <div id="summary-breakdown">
            <h2>Assessment Summary</h2>
            <div id="summary-breakdown-text"></div>
          </div>
        </div>
        <div id="summary-values">
          <h2>Values Profile</h2>
          <div id="summary-values-text"></div>
          <div class="values-bar">
            <div id="values-bar-fill" class="values-bar-fill"></div>
          </div>
          <div class="values-bar-labels">
            <span>Skills/Personality</span>
            <span>Appearance</span>
          </div>
        </div>
        <div id="summary-diagram">
          <h2>Upgrade Diagram</h2>
          <div class="diagram-frame">
            <img id="summary-body-img" src="/Autopsy.png" alt="Anatomical diagram" />
            <svg id="summary-body-overlay" viewBox="0 0 300 220" preserveAspectRatio="xMidYMid meet"></svg>
          </div>
        </div>
        <button id="export-button">EXPORT</button>
      </div>
    </div>
    <a-scene>
      <!-- Assets -->
      <a-assets>
        <!-- Mixamo sitting idle character -->
        <a-asset-item id="sittingModel" src="/Sitting Idle (3).glb"></a-asset-item>
      </a-assets>
      <!-- Camera with mouse-based raycaster for desktop interaction -->
      <!-- 
        MOUSE RAYCASTER SETUP:
        - Dedicated mouseCursor entity inside camera owns cursor + raycaster components
        - cursor="rayOrigin: mouse" makes clicks based on mouse position (not center reticle)
        - raycaster="objects: .menu-item-clickable" only targets menu items
        - No visual cursor ring - this is a desktop mouse experience
        - Click events are triggered automatically by the mouse raycaster
      -->
      <a-camera 
        id="camera" 
        position="0 2.2 -2.5" 
        look-controls="enabled: true">
        <!-- Dedicated mouse cursor entity - invisible, handles mouse-based raycasting -->
        <a-entity
          id="mouseCursor"
          cursor="rayOrigin: mouse; fuse: false"
          raycaster="objects: .menu-item-clickable; far: 50">
        </a-entity>
      </a-camera>
      <a-entity gltf-model="url(/potted_plant_mediterranean_med_leaf_low_poly.glb)" position="-4 0 -8.5"  scale="2 2 2"></a-entity>
      <!-- Menu Image -->
      <a-entity id="menu-container" position="0 4 -8.8">
        <a-image 
          src="/MENU-01.png"
          position="0 0 0"
          width="8"
          height="5.18"
          material="transparent: true; alphaTest: 0.1; shader: flat; side: double"
          fix-png-transparency>
        </a-image>
        <a-image 
          src="/MENU-02.png"
          position="4.8 -1.5 7.9"
          scale="1.6 1.6 1.6"
          rotation="0 270 0"
          width="8"
          height="5.18"
          material="transparent: true; alphaTest: 0.1; shader: flat; side: double"
          fix-png-transparency>
        </a-image>
        <!-- Bodyparts Container -->
        <a-entity
          id="bodyparts-container"
          position="-4.9 -1 4.9"
          rotation="0 90 0"
          scale="0.8 0.8 0.8">
          <a-image 
            src="/bodyparts.png"
            position="0 0 0"
            width="8"
            height="5.18"
            material="transparent: true; alphaTest: 0.1; shader: flat; side: double"
            fix-png-transparency>
          </a-image>
          
          <!-- Clickable colliders for bodyparts (7 total) -->
          <!-- Top row -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Height Extension; cost: 100"
            position="-2.9 1.5 0.02"
            width="1.2"
            height="1.8"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Shoulder Width; cost: 100"
            position="-1.1 1.5 0.02"
            width="1.2"
            height="0.8"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Breast Adjustments; cost: 100"
            position="0.8 1.5 0.02"
            width="1.2"
            height="0.8"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Middle row -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Waist Sculpting; cost: 100"
            position="-0.6 -0.2 0.02"
            width="1.3"
            height="1.1"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Ab Etching; cost: 100"
            position="1.8 0.1 0.02"
            width="1.8"
            height="1.4"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Arm Slimming; cost: 100"
            position="2.6 0 0.02"
            width="1.2"
            height="1.6"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Bottom row -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Butt Implants; cost: 100"
            position="-2.2 -1.5 0.02"
            width="2.4"
            height="1.0"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
        </a-entity>
        <a-image 
          src="/MENU-03.png"
          position="-4.8 -1 2.3"
          scale="1.6 1.6 1.6"
          rotation="0 90 0"
          width="8"
          height="5.18"
          material="transparent: true; alphaTest: 0.1; shader: flat; side: double"
          fix-png-transparency>
        </a-image>
        <!-- Facial Features Container -->
        <a-entity id="facial-features-container" position="4.9 -1.3 5.4" rotation="0 270 0" scale="0.7 0.7 0.7">
          <a-entity
            gltf-model="url(/Empty Stand.glb)"
            force-model-color="color: #f2f2f2"
            position="-11.5 -3.9 10"
            rotation="0 0 0"
            scale="3.5 3.5 3.5">
          </a-entity>
          <a-entity
            gltf-model="url(/Empty Stand.glb)"
            force-model-color="color: #f2f2f2"
            position="-9.5 -3.9 10"
            rotation="0 0 0"
            scale="3.5 3.5 3.5">
          </a-entity>
          <a-entity
            gltf-model="url(/Female face.glb)"
            position="-0.8 -3.9 0.2"
            rotation="0 0 0"
            scale="15 15 15">
          </a-entity>

          <!-- Clickable colliders for facial features (9 total) -->
          <!-- Left panel - 3x3 grid layout -->
          
          <!-- Top row left: Eyeballs → Eye Color -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Eye Color; cost: 100"
            position="-1.2 -3.2 0.8"
            width="1.4"
            height="0.9"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Top row middle: Eyelid → Eyelid Alteration -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Eyelid Alteration; cost: 100"
            position="-0.8 -3.2 0.8"
            width="1.4"
            height="0.9"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Top row right: Brows → Brow Lift -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Brow Lift; cost: 100"
            position="-0.4 -3.15 0.8"
            width="1.4"
            height="0.9"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Middle row left: Nose → Nose Job -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Nose Job; cost: 100"
            position="-0.8 -3.6 0.8"
            width="1.0"
            height="1.0"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Middle row middle: Lips → Lip Shape -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Lip Shape; cost: 100"
            position="-0.8 -3.9 0.8"
            width="1.2"
            height="0.8"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Middle row right: Cheekbone → Cheekbone Alteration -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Cheekbone Alteration; cost: 100"
            position="-0.2 -3.55 0.8"
            width="1.1"
            height="0.9"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Jawbone → Smile Brightening (position to be adjusted) -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Smile Brightening; cost: 100"
            position="-0.8 -4.1 0.8"
            width="1.2"
            height="0.8"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Bottom row left: Skin patch → Skin Texture Smoothing -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Skin Texture Smoothing; cost: 100"
            position="-1.2 -3.9 0.8"
            width="1.4"
            height="1.6"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Bottom row middle: Teeth → Jawline Altercation -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Jawline Altercation; cost: 100"
            position="-0.8 -4.3 0.8"
            width="1.4"
            height="1.1"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
          
          <!-- Right side: Full face → Face Lift -->
          <a-plane 
            class="menu-item-clickable"
            menu-choice="itemName: Face Lift; cost: 100"
            position="-0.8 -3.7 0.8"
            width="2.6"
            height="3.4"
            material="color: #00ff00; transparent: true; opacity: 0; side: double">
          </a-plane>
        </a-entity>

        <!-- Clickable Menu Items -->
        <!-- Menu is 8 units wide, 5.18 units tall -->
        <!-- Items are positioned relative to menu center (0, 0, 0) -->
        <!-- Each collider is narrow (width 2.4) and short (height 0.22) to match individual text lines -->
        <!-- X positions: PERSONALITY (left) x=-2.4, TECHNICAL (center) x=0, SOCIAL (right) x=2.4 -->
        <!-- Y positions: one row every -0.3 units, starting at 0.4 for the first item in each column -->
        <!-- Z position: 0.05 (slightly in front of menu image at z=0) -->

        <!-- PERSONALITY Section (left column, x = -2.4, 9 items) -->
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Confidence Boost; cost: 100"
          position="-2.4 -0.38 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Politeness Filter; cost: 100"
          position="-2.4 -0.58 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Small-Talk Expansion Pack; cost: 100"
          position="-2.4 -0.78 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Empathy Upgrade; cost: 100"
          position="-2.4 -0.98 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Agreeableness; cost: 100"
          position="-2.4 -1.18 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Charisma / Humor; cost: 100"
          position="-2.4 -1.38 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Leadership Aura; cost: 100"
          position="-2.4 -1.58 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: No-Awkwardness; cost: 100"
          position="-2.4 -1.78 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Likeability Boost; cost: 100"
          position="-2.4 -1.98 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>

        <!-- TECHNICAL Section (center column, x = 0, 9 items) -->
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Advanced Math Fluency; cost: 100"
          position="0 -0.38 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Data Analysis Literacy; cost: 100"
          position="0 -0.58 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Public Speaking Mastery; cost: 100"
          position="0 -0.68 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Financial Literacy; cost: 100"
          position="0 -0.88 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Software Proficiency (All); cost: 100"
          position="0 -1.08 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Scientific Reasoning Boost; cost: 100"
          position="0 -1.28 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Fast Research Capability; cost: 100"
          position="0 -1.48 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Memory Enhancement; cost: 100"
          position="0 -1.68 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Fluent in All Languages; cost: 100"
          position="0 -1.88 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>

        <!-- SOCIAL Section (right column, x = 2.4, 7 items) -->
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Negotiation Ability; cost: 100"
          position="2.4 -0.28 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Client Fluency; cost: 100"
          position="2.4 -0.48 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Leadership Skill Pack; cost: 100"
          position="2.4 -0.68 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Collaboration Efficiency; cost: 100"
          position="2.4 -0.88 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Conflict Management; cost: 100"
          position="2.4 -1.08 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Multitasking Ability; cost: 100"
          position="2.4 -1.28 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
        
        <a-plane 
          class="menu-item-clickable"
          menu-choice="itemName: Quick Learning; cost: 100"
          position="2.4 -1.48 0.05"
          width="2.4"
          height="0.22"
          material="color: #00ff00; transparent: true; opacity: 0; side: double">
        </a-plane>
      </a-entity>
      <a-entity gltf-model="url(/potted_plant_wk_8.glb)" position="4 0.7 -8.3" scale="0.02 0.02 0.02"></a-entity>
      <a-entity gltf-model="url(/ceiling_fluorescent_light.glb)"
                material="emissive:#ffffff; emissiveIntensity:2"
                position="0 10 -2.5"
                scale="0.05 0.05 0.05"
                rotation="0 90 0">
        <a-light type="spot"
                 color="#fffdd0"
                 intensity="2"
                 angle="60"
                 penumbra="0.5"
                 distance="25"
                 decay="2"
                 position="0 10 -2.5"
                 rotation="-90 0 0"></a-light>
      </a-entity>
  
    
      <a-light type="ambient"
               color="#ffffff"
               intensity="0.25"></a-light>

      <a-entity gltf-model="url(/free_empty_room.glb)" position="0 0 -4"></a-entity>
      <a-entity position="0 0 -2.5" rotation="0 180 0" scale="0.01 0.01 0.01">
        <a-entity gltf-model="url(/elsie_stackable_dining_chair_white.glb)" scale="2 2 2"></a-entity>
      </a-entity>
      <a-entity gltf-model="url(/door_with_frame.glb)" position="0 0 1" rotation="0 180 0" scale="0.02 0.02 0.02"></a-entity>
      <a-entity gltf-model="url(/window_blind02_-_2mb.glb)" position="2.8 4.3 0.8" rotation="0 90 0" scale="1.6 1.6 1.6"></a-entity>
      <a-entity gltf-model="url(/window_blind02_-_2mb.glb)" position="-2.8 4.3 0.8" rotation="0 90 0" scale="1.6 1.6 1.6"></a-entity>
      <a-entity gltf-model="url(/long_table_and_chairs_low_poly.glb)" position="0 0 -4" rotation="0 180 0" scale="2 2 2"></a-entity>
      <a-entity gltf-model="url(/tablet_folder.glb)" position="0.5 1.45 -4" rotation="0 90 0" scale="0.02 0.02 0.02"></a-entity>
      <a-entity id="mannequin" gltf-model="url(/chmil_mannequin_bust_2024.glb)" face-camera force-model-color="color: #ffffff" position="-1.5 1.7 -4" rotation="0 360 0" scale="1.5 1.5 1.5"></a-entity>

      <!-- Money counter in 3D space (optional, if you want it in the scene) -->
      <a-text 
        id="money-text"
        value="$1000"
        position="2 2.5 -2.5"
        align="left"
        color="#565656"
        scale="2 2 2"
        visible="false"        
        look-at="#camera">
      </a-text>
      <!-- Sitting character model (Mixamo GLB) replacing the red box -->
      <a-entity 
        id="sittingPerson"
        gltf-model="#sittingModel"
        animation-mixer="clip: *; loop: repeat; reorient: true; startAt: 0.5;"
        position="0.7 -0.3 -4.9"
        rotation="0 0 0"
        scale="2.5 2.5 2.5">
      </a-entity>
      <a-plane 
               position="0 0 -4" 
               rotation="-90 0 0" 
               width="4" 
               height="4" 
               scale="2 2 1" 
               color="#7BC8A4">
      </a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </body>
  </html>


